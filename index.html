<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAVVA Â· SolidJS</title>

  <!-- Preload theme to avoid flash -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem("theme");
        // Default to dark theme
        const theme = saved || "dark";
        document.documentElement.classList.toggle("dark", theme === "dark");
      } catch { }
    })();
  </script>

  <script>
    (function () {
      // Determine if we should use hash routing
      function shouldUseHashRouting() {
        const protocol = location.protocol;
        const hostname = location.hostname;

        // Use hash routing for:
        // 1. file:// protocol (local HTML files)
        // 2. IPFS gateways
        // 3. localhost or 127.0.0.1
        if (protocol === "file:") return true;
        if (hostname === "localhost" || hostname === "127.0.0.1" || hostname === "[::1]") return true;
        if (hostname.includes("ipfs") || hostname.includes("ipns") ||
            location.pathname.startsWith("/ipfs/") || location.pathname.startsWith("/ipns/")) {
          return true;
        }
        return false;
      }

      // Only convert paths to hash if we're in hash routing mode
      if (shouldUseHashRouting() && !location.hash) {
        let path = location.pathname;
        let newHash = "";

        // Check for legacy /content/ URL
        if (path.startsWith("/content/")) {
          const savvaId = path.substring("/content/".length);
          newHash = "#/post/" + savvaId;
        } else if (path !== "/") {
          newHash = "#" + path + location.search;
        }

        if (newHash) {
          history.replaceState(null, "", "/" + newHash);
        }
      }
    })();
  </script>


  <!-- Load app after theme class is set -->
  <script type="module" src="/src/index.jsx"></script>
</head>

<body>
  <div id="root"></div>
</body>

</html>