# Показ постов

Отображение поста SAVVA — это процесс из двух этапов. Сначала вы получаете список объектов метаданных постов из бэкенда SAVVA. Затем вы используете информацию IPFS из этих метаданных, чтобы получить фактическое содержание (например, заголовок, текст и изображения) из децентрализованной сети.

---

## Шаг 1: Получение метаданных поста из бэкенда

Основной способ получить список постов — это метод WebSocket `content-list`. Это гибкая конечная точка, которая поддерживает пагинацию, сортировку и фильтрацию.

### Вызов `content-list`

Вы вызываете метод с параметрами, указывающими, какой контент вам нужен. Вот типичный пример:

```javascript
// Пример вызова с использованием вспомогательного метода wsMethod приложения
const posts = await app.wsMethod("content-list")({
  domain: "savva.app",      // Домен для получения постов
  limit: 12,                // Количество элементов на странице
  offset: 0,                // Начать с первого элемента (для пагинации)
  lang: "en",               // Предпочтительный язык для любых возвращаемых метаданных
  order_by: "fund_amount",  // Сортировать по общей сумме полученных средств
  content_type: "post",     // Мы хотим только посты
  category: "en:SAVVA Talk" // Необязательно: фильтровать по конкретной категории
});
```

### Структура объекта поста

Метод `content-list` возвращает массив объектов постов. Каждый объект содержит всю необходимую информацию о метаданных и указатели для получения полного содержания.

Вот пример одного объекта поста, возвращенного из бэкенда:

```json
{
  "author": {
    "address": "0x1234...",
    "avatar": "Qm...",
    "name": "alexna",
    "display_name": "Alex Na",
    "staked": "5000000000000000000000"
  },
  "category": "en:SAVVA Talk",
  "domain": "savva.app",
  "effective_time": "2025-08-20T10:30:00Z",
  "fund": {
    "amount": "125000000000000000000",
    "round_time": 1672531200,
    "total_author_share": "100000000000000000000"
  },
  "ipfs": "bafybeig.../info.yaml",
  "data_cid": "bafybeig...",
  "reactions": [10, 2, 0, 1],
  "savva_cid": "0x01701...cfa2",
  "short_cid": "aBcDeF1",
  "tags": ["децентрализация", "социальные"],
  "savva_content": {
    "locales": {
      "en": {
        "text_preview": "This is a short preview of the post content...",
        "title": "My First Post on SAVVA"
      },
      "ru": {
        "text_preview": "Это короткий анонс содержания поста...",
        "title": "Мой первый пост на SAVVA"
      }
    },
    "thumbnail": "thumbnail.jpg"
  }
}
```

### Объяснение ключевых полей

* **author**: Информация о профиле автора поста, включая его ставку.
* **savva\_cid / short\_cid**: Уникальные идентификаторы поста. `savva_cid` — это полный идентификатор в цепочке, в то время как `short_cid` — это удобный для пользователя альтернативный вариант. Используйте их для построения URL (например, `/post/<short_cid>`).
* **ipfs & data\_cid**: Ключевые указатели на контент в IPFS. Смотрите следующий раздел о том, как их использовать.
* **savva\_content**: Объект метаданных, полученный непосредственно из кэша бэкенда. Он содержит объект `locales` с предварительно загруженными заголовками и анонсами, что идеально подходит для отображения карточек постов в ленте без необходимости предварительно загружать из IPFS.
* **fund**: Информация о фонде поста.
* **reactions**: Массив, представляющий количество различных типов реакций (лайк, супер и т.д.).

---

## Шаг 2: Получение полного контента из IPFS

Хотя `savva_content` полезен для предварительного просмотра, вам нужно получить данные из IPFS, чтобы получить полный текст поста, главы и другие ресурсы.

### Поиск дескриптора и папки данных

Поля `ipfs` и `data_cid` работают вместе, чтобы указать, где находится все. Есть два сценария:

1. **`data_cid` присутствует**:

   * `ipfs` — это прямой путь к файлу дескриптора (например, `bafy.../info.yaml`).
   * `data_cid` — это CID папки, содержащей все ресурсы поста (изображения, файлы markdown и т.д.). Это ваша база контента.

2. **`data_cid` НЕ присутствует (наследуемый формат)**:

   * `ipfs` — это CID папки, содержащей все ресурсы поста.
   * Предполагается, что файл дескриптора находится по стандартному пути: `<ipfs>/info.yaml`.

Логика приложения должна определять путь к дескриптору и CID базы контента на основе этих правил.

### Дескриптор поста (`info.yaml`)

Дескриптор — это файл YAML, который определяет полную структуру поста, включая все его языковые варианты и главы.

#### Пример `info.yaml`

```yaml
# Пример info.yaml для многоязычного поста с несколькими главами

thumbnail: assets/post_thumbnail.png

locales:
  en:
    title: "Understanding Decentralized Systems"
    text_preview: "A deep dive into the core concepts of decentralization..."
    tags: ["blockchain", "systems", "web3"]
    categories: ["Technology"]
    # Основной контент, может быть встроенным или по пути
    data_path: content/en/main.md
    chapters:
      - title: "What is a Blockchain?"
        data_path: content/en/chapter1.md
      - title: "IPFS and Content Addressing"
        data_path: content/en/chapter2.md
  
  ru:
    title: "Понимание децентрализованных систем"
    text_preview: "Глубокое погружение в основные концепции децентрализации..."
    tags: ["блокчейн", "системы", "web3"]
    categories: ["Технологии"]
    data_path: content/ru/main.md
    chapters:
      - title: "Что такое блокчейн?"
        data_path: content/ru/chapter1.md
      - title: "IPFS и контентная адресация"
        data_path: content/ru/chapter2.md
```

### Ключевые поля дескриптора

* **thumbnail**: Относительный путь к главному изображению поста, разрешенному относительно базы контента CID.
* **locales**: Объект, где каждый ключ — это код языка (например, `en`, `ru`).
* **title / text\_preview / tags / categories**: Метаданные, специфичные для языка.
* **data\_path**: Относительный путь к основному контенту Markdown для этого языка.
* **chapters**: Массив объектов глав, каждая из которых имеет свой заголовок и `data_path`.

Чтобы получить полный контент главы, вы комбинируете базу контента CID с `data_path` из дескриптора. Например, чтобы получить английскую версию Главы 1, вы бы запросили:

```
<content_base_cid>/content/en/chapter1.md
```

из шлюза IPFS.