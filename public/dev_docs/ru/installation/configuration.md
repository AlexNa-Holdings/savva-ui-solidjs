# Конфигурация

Расширенные параметры конфигурации для вашей установки SAVVA.

## Обзор

Этот документ описывает расширенную конфигурацию, выходящую за рамки базовой настройки.

## Настройка бота Telegram

SAVVA поддерживает интеграцию с ботом Telegram для аутентификации пользователей и уведомлений. Для каждого домена можно использовать собственного бота Telegram.

### Создание бота Telegram

1. **Откройте Telegram** и найдите `@BotFather`

2. **Создайте нового бота**:
   - Отправьте `/newbot` BotFather
   - Введите отображаемое имя для бота (например, «SAVVA Network»)
   - Введите имя пользователя для бота (должно заканчиваться на `bot`, например, `savva_network_bot`)

3. **Сохраните токен бота**:
   - BotFather выдаст API-токен вида: `7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - Храните этот токен в безопасности — любой, у кого есть этот токен, может управлять вашим ботом

4. **Настройте параметры бота** (необязательно, но рекомендуется):
   - Отправьте `/setdescription` — добавьте описание вашей инстанции SAVVA
   - Отправьте `/setabouttext` — добавьте информацию, отображаемую в профиле бота
   - Отправьте `/setuserpic` — загрузите логотип вашей сети в качестве аватара бота

### Конфигурация бэкенда

Добавьте настройки бота Telegram в ваш `/etc/savva.yml`:

```yaml
# Telegram Bot Configuration
telegram:
  bot-token: "7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

### Регистрация вебхука

После настройки бэкенда необходимо зарегистрировать URL вебхука в Telegram. Это сообщает Telegram, куда отправлять обновления, когда пользователи взаимодействуют с вашим ботом:

```bash
curl -F "url=https://yourdomain/api/telegram-bot/yourdomain" \
  https://api.telegram.org/bot7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/setWebhook
```

Замените:
- `yourdomain` на ваш реальный домен (появляется дважды в URL)
- `7123456789:AAHxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` на токен вашего бота

**Ожидаемый ответ:**
```json
{"ok":true,"result":true,"description":"Webhook was set"}
```

**Проверьте статус вебхука:**
```bash
curl https://api.telegram.org/bot<your_bot_token>/getWebhookInfo
```

### Как это работает

После настройки пользователи могут:
- Привязать свой аккаунт Telegram к профилю SAVVA
- Получать уведомления о новых подписчиках, комментариях и упоминаниях
- Использовать Telegram как дополнительный метод аутентификации

### Примечания по безопасности

- Никогда не публикуйте токен бота
- Токен бота в `savva.yml` должен иметь ограниченные права доступа к файлу (`chmod 600`)
- Рассмотрите использование переменных окружения для токена в продакшене:
  ```yaml
  telegram:
    bot-token: ${TELEGRAM_BOT_TOKEN}
  ```