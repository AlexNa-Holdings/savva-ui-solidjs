# Відображення Постів

Відображення поста SAVVA є процесом, що складається з двох етапів. Спочатку ви отримуєте список об'єктів метаданих постів з бекенду SAVVA. Потім ви використовуєте інформацію IPFS з цих метаданих, щоб отримати фактичний контент (такі як заголовок, текст та зображення) з децентралізованої мережі.

---

## Крок 1: Отримання Метаданих Постів з Бекенду

Основний спосіб отримати список постів - це метод WebSocket `content-list`. Це гнучка точка доступу, яка підтримує пагінацію, сортування та фільтрацію.

### Виклик `content-list`

Ви викликаєте метод з параметрами, що вказують, який контент вам потрібен. Ось типовий приклад:

```javascript
// Приклад виклику з використанням допоміжного методу wsMethod програми
const posts = await app.wsMethod("content-list")({
  domain: "savva.app",      // Домен для отримання постів
  limit: 12,                // Кількість елементів на сторінці
  offset: 0,                // Почати з першого елемента (для пагінації)
  lang: "en",               // Бажана мова для будь-яких повернених метаданих
  order_by: "fund_amount",  // Сортувати за загальною сумою отриманих коштів
  content_type: "post",     // Ми хочемо лише пости
  category: "en:SAVVA Talk" // Необов'язково: фільтрувати за конкретною категорією
});
```

### Структура Об'єкта Поста

Метод `content-list` повертає масив об'єктів постів. Кожен об'єкт містить усі метадані на ланцюзі та вказівники, необхідні для отримання повного контенту.

Ось приклад одного об'єкта поста, повернутого з бекенду:

```json
{
  "author": {
    "address": "0x1234...",
    "avatar": "Qm...",
    "name": "alexna",
    "display_name": "Alex Na",
    "staked": "5000000000000000000000"
  },
  "category": "en:SAVVA Talk",
  "domain": "savva.app",
  "effective_time": "2025-08-20T10:30:00Z",
  "fund": {
    "amount": "125000000000000000000",
    "round_time": 1672531200,
    "total_author_share": "100000000000000000000"
  },
  "ipfs": "bafybeig.../info.yaml",
  "data_cid": "bafybeig...",
  "reactions": [10, 2, 0, 1],
  "savva_cid": "0x01701...cfa2",
  "short_cid": "aBcDeF1",
  "tags": ["decentralization", "social"],
  "savva_content": {
    "locales": {
      "en": {
        "text_preview": "This is a short preview of the post content...",
        "title": "My First Post on SAVVA"
      },
      "ru": {
        "text_preview": "Это короткий анонс содержания поста...",
        "title": "Мой первый пост на SAVVA"
      }
    },
    "thumbnail": "thumbnail.jpg"
  }
}
```

### Пояснення Ключових Полів

* **author**: Інформація профілю автора поста, включаючи їхню суму стейку.
* **savva\_cid / short\_cid**: Унікальні ідентифікатори поста. `savva_cid` - це повний ідентифікатор на ланцюзі, тоді як `short_cid` - це зручна альтернатива. Використовуйте їх для побудови URL (наприклад, `/post/<short_cid>`).
* **ipfs & data\_cid**: Важливі вказівники на контент в IPFS. Дивіться наступний розділ, щоб дізнатися, як їх використовувати.
* **savva\_content**: Об'єкт метаданих безпосередньо з кешу бекенду. Він містить об'єкт `locales` з попередньо завантаженими заголовками та анонсами, що ідеально підходить для відображення карток постів у стрічці без необхідності спочатку отримувати з IPFS.
* **fund**: Інформація про фонд поста.
* **reactions**: Масив, що представляє кількість різних типів реакцій (подобається, супер тощо).

---

## Крок 2: Отримання Повного Контенту з IPFS

Хоча `savva_content` корисний для попереднього перегляду, вам потрібно отримати з IPFS, щоб отримати повний текст поста, глави та інші активи.

### Знаходження Описника та Папки Даних

Поля `ipfs` та `data_cid` працюють разом, щоб вказати, де все знаходиться. Є два сценарії:

1. **`data_cid` присутній**:

   * `ipfs` - це прямий шлях до файлу описника (наприклад, `bafy.../info.yaml`).
   * `data_cid` - це CID папки, що містить усі активи поста (зображення, markdown файли тощо). Це ваша базова частина контенту.

2. **`data_cid` НЕ присутній (старий формат)**:

   * `ipfs` - це CID папки, що містить усі активи поста.
   * Файл описника вважається розташованим за стандартним шляхом: `<ipfs>/info.yaml`.

Логіка програми повинна визначити шлях до описника та CID бази контенту на основі цих правил.

### Описник Поста (`info.yaml`)

Описник - це YAML файл, який визначає повну структуру поста, включаючи всі його мовні варіації та глави.

#### Приклад `info.yaml`

```yaml
# Приклад info.yaml для багатомовного, багатоглавного поста

thumbnail: assets/post_thumbnail.png

locales:
  en:
    title: "Understanding Decentralized Systems"
    text_preview: "A deep dive into the core concepts of decentralization..."
    tags: ["blockchain", "systems", "web3"]
    categories: ["Technology"]
    # Основний контент, може бути вбудованим або шляхом
    data_path: content/en/main.md
    chapters:
      - title: "What is a Blockchain?"
        data_path: content/en/chapter1.md
      - title: "IPFS and Content Addressing"
        data_path: content/en/chapter2.md
  
  ru:
    title: "Понимание децентрализованных систем"
    text_preview: "Глубокое погружение в основные концепции децентрализации..."
    tags: ["блокчейн", "системы", "web3"]
    categories: ["Технологии"]
    data_path: content/ru/main.md
    chapters:
      - title: "Что такое блокчейн?"
        data_path: content/ru/chapter1.md
      - title: "IPFS и контентная адресация"
        data_path: content/ru/chapter2.md
```

### Ключові Поля Описника

* **thumbnail**: Відносний шлях до основного зображення поста, вирішеного відносно бази контенту CID.
* **locales**: Об'єкт, де кожен ключ - це код мови (наприклад, `en`, `ru`).
* **title / text\_preview / tags / categories**: Метадані, специфічні для мови.
* **data\_path**: Відносний шлях до основного Markdown контенту для цієї мови.
* **chapters**: Масив об'єктів глав, кожен з яких має свій заголовок та `data_path`.

Щоб отримати повний контент глави, ви поєднуєте базу контенту CID з `data_path` з описника. Наприклад, щоб отримати англійську версію Глави 1, ви б запитали:

```
<content_base_cid>/content/en/chapter1.md
```

з шлюзу IPFS.