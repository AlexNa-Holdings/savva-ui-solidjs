# Робота з доменами

Домен — це просто назва соціальної мережі, яку ви хочете відобразити. Зазвичай це DNS‑хост сайту (наприклад, `savva.app`), але не обов’язково. Кожен домен має доменний пакет — папку, що містить `config.yaml` та всі специфічні для домену ресурси (логотипи, favicon, локалі, конфіг вкладок, опціональний `domain.css` тощо).

## Де зберігається `config.yaml`?

Під час виконання додаток обчислює базовий URL ресурсів (assets base URL) з `/info`:
- **Продакшн:** `assets_url`
- **Тест:** `temp_assets_url`

Активне середовище — простий перемикач prod/test у додатку (використовується адміністраторами для тестування змін). Маючи **вибрану назву домену**, додаток будує префікс:

```

<assetsBase>/<domain>/

```

Потім додаток намагається завантажити:

```

<assetsBase>/<domain>/config.yaml

```

Якщо це не вдається (пак не знайдено, 404 тощо), UI **повертається** до вбудованого пакета за замовчуванням:

```

/domain\_default/config.yaml

```

> Цей механізм пошуку та діагностики централізований; ви побачите ті самі шляхи в діагностичному UI.  
> Активний `domain.css` завантажується з того ж префікса і отримує кеш‑бастинг через ключ ревізії, тож зміни застосовуються одразу після завантаження.

## Чому два середовища (prod / test)?

Бекенд надає два базові URL для ресурсів:

- **`assets_url`** → продакшн‑пак для кінцевих користувачів  
- **`temp_assets_url`** → тестовий пак для попереднього перегляду змін

Адміністратор (як налаштовано в бекенді) може розмістити змінений пакет домену під **тестовим** базовим URL і перевірити все (логотипи, вкладки, GA, кольори) без впливу на користувачів. Коли все задовільно, той самий пак публікують у **продакшн**.

## Структура пакета домену

Усе для домену зберігається в одній папці:

```

<assetsBase>/<domain>/
config.yaml          # основна конфігурація (логотипи, favicon, локалі, модулі)
domain.css           # опційні змінні теми (кольори, фони)
i18n/*.yaml          # словники мов (на кожну локаль)
images/*             # бренд‑ресурси
modules/tabs.yaml    # опис вкладок для головного екрану
modules/*.yaml       # інші конфіги модулів (опційно)
html/*.html          # довільні HTML‑блоки (опційно)

````

## Приклад `config.yaml`

Нижче — обрізаний приклад, що показує типові поля, які використовує додаток:

```yaml
logo:
  light: images/logo_light.png
  dark: images/logo_dark.png
  light_mobile: images/logo_light.png
  dark_mobile: images/logo_dark.png

favicon:
  apple-touch-icon: favicon/apple-touch-icon.png
  16: favicon/favicon-16x16.png
  32: favicon/favicon-32x32.png
  manifest: favicon/site.webmanifest
  mask-icon:
    href: favicon/safari-pinned-tab.svg
    color: '#5bbad5'
  base: favicon/favicon.ico
  meta:
    - name: msapplication-TileColor
      content: '#da532c'
    - name: theme-color
      content: '#ffffff'

GA_tag: G-XXXXXXXXXX   # Google Analytics (gtag) ID
promo_post: ''          # savva_cid of a post to show on first site opening

modules:
  tabs: modules/tabs.yaml
  content_lists: modules/content_lists.yaml
  staker_levels: modules/staker_levels.yaml
  categories: modules/categories.yaml

default_locale: en
locales:
  - code: en
    name: English
    title: 'SAVVA.APP - Beyond Likes Social'
    dictionary: i18n/en.yaml
  - code: ru
    name: Русский
    title: 'SAVVA.APP - За пределами лайков'
    dictionary: i18n/ru.yaml
````

### За що відповідають ці поля

* **`logo`** — Додаток автоматично обирає найкращий варіант (темний/світлий + мобільний/десктоп) і резольвить його через активний префікс домену.
* **`favicon`** — Всі посилання на favicon та meta‑теги застосовуються динамічно; при зміні конфігурації додаток замінює набір `<link rel="icon">`.
* **`GA_tag`** — Увімкнення Google Analytics (gtag.js). Якщо встановлено, додаток інжектить GA‑скрипти і відсилає SPA‑події `page_view` при зміні маршрутів.
* **`promo_post`** — Опційний savva_cid посту, який показується при першому відкритті сайту. Можна використовувати для вітального чи анонсового посту для нових користувачів.
* **`modules.tabs`** — Посилання на YAML, що визначає вкладки на головному екрані (див. нижче).
* **`locales`** — Список мов для домену (код/назва/титул + шлях до словника). Додаток може рендерити локалізовані титули та рядки для кожного домену.

## Вкладки на головному екрані

Вкладки конфігуруються в окремому YAML (посилається через `modules.tabs` вище). Наприклад:

```yaml
# modules/tabs.yaml
tabs:
  - type: leaders
    title:
      en: Leaders
      ru: Лидеры
    right_panel:
      available: true
      blocks:
        - type: html
          en: /html/info_block_en.html
          ru: /html/info_block_ru.html
        - type: content_List
          list_name: main
          count: 7

  - type: new
    title:
      en: New
      ru: Новое
```

UI вибирає локалізований заголовок вкладки, підбирає іконку за `type` і рендерить опціональні блоки правої панелі. Цей файл живе в **тій самій папці домену**, тож він версіонується і переглядається разом з `config.yaml`.

## Кольори теми через `domain.css`

Якщо присутній, `domain.css` завантажується з того ж префікса домену і застосовується під час виконання. Зазвичай він визначає CSS‑змінні, які використовує UI (фони, передній план, акценти, межі тощо). Перемикання **домену** або **середовища** перезавантажує цей CSS, тож адміністратори можуть тонко налаштувати брендинг без перезбірки додатку.

Приклад змінних:

```css
:root {
  --gradient: linear-gradient(to top left, #000c40, #607d8b);
  --background: 243 100% 98.26%;
  --foreground: 243 10% 0.52%;
  --muted: 243 10% 91.3%;
  --muted-foreground: 243 5% 41.3%;
  --primary: 243 100% 13%;
  --primary-foreground: 243 2% 98%;
  /* ... */
}
```

## Google Analytics (GA)

Встановіть `GA_tag` у `config.yaml`, щоб увімкнути GA. Додаток інжектить GA‑скрипт, ініціалізує `gtag(...)` автоматично і також відстежує перегляди сторінок при зміні hash‑маршрутів. Видаліть або очистіть `GA_tag`, щоб вимкнути аналітику для домену.

---

### Підсумок

* Додаток обирає базу ресурсів **prod** або **test**, після чого завантажує `<base>/<domain>/config.yaml` з надійним fallback до `/domain_default/config.yaml`.
* **Усі** ресурси домену (логотипи, локалі, вкладки, `domain.css`) зберігаються в одній папці для атомарних оновлень.
* Адміністратори можуть попередньо переглядати зміни в **test** перед публікацією в **prod**.
* `config.yaml` керує брендингом (логотипи, favicon), локалізацією, GA та визначає, де знаходяться UI‑модулі, наприклад **вкладки**.