# Публікація Посту

Публікація контенту на платформі SAVVA є трьохетапним процесом, який забезпечує цілісність даних, децентралізацію та перевірку в ланцюгу. Процес включає підготовку даних посту локально, завантаження контенту та його опису до IPFS, а також реєстрацію посту в блокчейні через виклик смарт-контракту.

Фронтенд-редактор автоматизує цей процес через майстра, але розуміння основних етапів є важливим для розробників.

---

## Крок 1: Підготовка Даних Посту

Перед будь-яким завантаженням або транзакцією редактор організовує пост у стандартизовану структуру директорій. Цю структуру керують локально, використовуючи API файлової системи.

Основні компоненти:

* Файл параметрів (`params.json`) для налаштувань, специфічних для редактора.
* Файл опису (`info.yaml`), який визначає структуру посту та метадані для IPFS.
* Markdown файли для контенту кожної мови.
* Директорія `uploads/` для будь-яких супутніх медіафайлів (зображення, відео тощо).

### Приклад `params.json`

Цей файл містить налаштування, які використовуються інтерфейсом редактора, і не публікується в ланцюзі.

```json
{
  "guid": "c4a7f6b9-6e3e-4b9e-8b1e-2e4a6d7c8b9a",
  "nsfw": false,
  "fundraiser": 0,
  "publishAsNewPost": true,
  "locales": {
    "en": {
      "tags": ["децентралізація", "соціальні"],
      "categories": ["Технології"],
      "chapters": [
        { "title": "Що таке блокчейн?" },
        { "title": "IPFS та адресація контенту" }
      ]
    }
  },
  "thumbnail": "uploads/thumbnail.png"
}
```

### Приклад `info.yaml` (Опис Посту)

Цей файл є канонічним визначенням посту і завантажується до IPFS. Він зв'язує всі частини контенту разом.

```yaml
savva_spec_version: "2.0"
data_cid: bafybeih...
gateways:
  - https://ipfs.io/
locales:
  en:
    title: "Розуміння децентралізованих систем"
    text_preview: "Глибоке занурення в основні концепції децентралізації..."
    data_path: "en/data.md"
    chapters:
      - data_path: "en/chapters/1.md"
      - data_path: "en/chapters/2.md"
```

* **data\_cid**: CID IPFS директорії, що містить весь Markdown контент та завантажені файли.
* **locales**: Містить метадані, специфічні для мови. Заголовок та текст\_прев'ю з редактора зберігаються тут.
* **data\_path / chapters.data\_path**: Відносні шляхи до файлів контенту в директорії `data_cid`.

---

## Крок 2: Завантаження до IPFS

Процес завантаження відбувається в два окремі етапи, які обробляються API зберігання бекенду.

1. **Завантаження Директорії Контенту**: Усі файли контенту (наприклад, `en/data.md`, `en/chapters/1.md`, `uploads/thumbnail.png`) завантажуються як одна директорія до IPFS. Бекенд повертає єдиний CID IPFS для цієї директорії, який стає `data_cid`.
2. **Завантаження Опису**: Файл `info.yaml` генерується з `data_cid` з попереднього етапу. Цей YAML файл потім завантажується до IPFS як окремий файл. CID цього файлу `info.yaml` є фінальним вказівником IPFS для посту.

---

## Крок 3: Реєстрація в Блокчейні

Останній крок - зафіксувати пост у блокчейні, викликавши функцію `reg` на смарт-контракті `ContentRegistry`.

Фронтенд виконує цю транзакцію з наступними параметрами:

* **domain**: Поточна назва домену (наприклад, `savva.app`).
* **author**: Адреса гаманця користувача.
* **guid**: Унікальний ідентифікатор з `params.json`.
* **ipfs**: CID IPFS файлу опису `info.yaml` з Кроку 2.
* **content\_type**: Рядок `bytes32`, зазвичай `post` для нового контенту або `post-edit` для оновлень.

### Приклад Виклику Контракту

```javascript
// З: src/x/editor/wizard_steps/StepPublish.jsx

const contract = await getSavvaContract(app, "ContentRegistry", { write: true });

const hash = await contract.write.reg([
  domain,           // "savva.app"
  user.address,     // "0x123..."
  guid,             // "c4a7f6b9-..."
  descriptorCid,    // "bafybeif..."
  toHexBytes32("post")
]);

// Інтерфейс користувача потім чекає на підтвердження транзакції
const receipt = await publicClient.waitForTransactionReceipt({ hash });
```

Якщо транзакцію успішно оброблено, пост офіційно публікується і з'явиться в контентних стрічках.